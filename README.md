# 线程池异步日志处理库

## 项目概述
这是一个基于C语言实现的高效线程池日志处理库，采用生产者-消费者模型实现异步日志记录。通过线程池管理日志写入任务，有效提升系统性能，避免同步日志造成的I/O阻塞问题。

## 核心功能
✅ **线程池管理**  
- 支持自定义线程数量（默认10线程）
- 自动任务队列管理
- 优雅停机机制（SIGINT信号处理）

✅ **异步日志处理**  
- 支持5种日志类型：ERROR/INFO/RUN/INET/MEM
- 每种日志类型独立文件存储
- 自带时间戳和进程/线程信息

✅ **线程安全机制**  
- 每个日志类型独立互斥锁
- 无锁队列管理任务
- 条件变量实现高效任务通知

## 核心优势
🚀 **高性能**
- 任务提交与执行解耦，最高可达10万日志/秒（取决于磁盘速度）
- 避免直接I/O阻塞主线程

🔒 **高可靠性**
- 崩溃前自动刷新日志缓存
- 原子化日志写入操作
- 多级错误处理机制

🔧 **高扩展性**
- 易于添加新日志类型
- 支持自定义日志格式
- 灵活的任务处理机制

## 快速开始
```bash
# 编译
gcc -o logger main.c -lpthread

# 运行（默认每秒产生一条ERROR日志）
./logger

# 优雅退出
Ctrl+C 发送SIGINT信号
```

## 使用示例
```c
// 初始化线程池
struct thread_pool *pool = thread_pool_create(8);

// 提交日志任务
struct Err_info msg = {ERROR_TYPE, "Disk write failure"};
log_gn(msg);

// 程序退出时
thread_pool_destroy(pool);
```

## 优化方向
### 功能增强
🛠️ 动态线程调节：根据负载自动扩缩容线程池  
🛠️ 日志滚动策略：按大小/时间自动分割日志文件  
🛠️ 异步I/O优化：结合libaio实现更高效写入

### 性能优化
⚡ 无锁队列实现：替换当前的互斥锁方案  
⚡ 批量写入机制：合并多个日志条目一次性写入  
⚡ 内存池优化：预分配任务内存减少malloc开销

### 可靠性提升
🔐 异常恢复机制：日志文件损坏时自动重建  
🔐 写入失败重试：网络存储场景下的容错处理  
🔐 内存保护：防止内存泄漏的守护线程

### 扩展功能
🌐 网络日志支持：UDP/TCP日志转发  
📊 监控接口：暴露线程池状态指标  
📁 压缩归档：自动压缩历史日志文件

## 架构图
```
+-----------------+     +-------------------+     +---------------+
|     应用程序     | --> |   线程池-任务队列  | --> |    工作线程    |
|                 |     |                   |     |               |
+-----------------+     +-------------------+     +-------+-------+
                                                          |
                                                          v
                                                    +------------+
                                                    |  日志记录   |
                                                    |            |
                                                    +------------+
```
